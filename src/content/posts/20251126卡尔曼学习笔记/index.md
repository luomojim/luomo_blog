---
title: 卡尔曼滤波笔记
published: 2025-11-26
pinned: false
description: 我自己的卡尔曼滤波(kf)学习笔记.
tags: [Kalman Filter, bloging]
category: 算法
draft: false
date: 2025-11-26
pubDate: 2025-11-26
---


**放在开头：**
因为还没有学得那么深入，所以只好把自己能弄懂的写出来了，剩下的我也看不懂...

# Kalman Filter 卡尔曼滤波器笔记
## 滤波器是什么
要学习卡尔曼滤波器，首先就要先了解滤波器的作用原理，以及滤波器有什么用。
### 什么是滤波
滤波归属于信号处理领域，从语文的角度去理解，波就是信号，滤可以理解为过滤，意思就是说对收集到的信号(传感器数据，定位信号，图像信号等等)，这些收集到的信号往往受限于设备与环境，会产生不同的误差，这些误差被称之为噪声，这些噪声往往会影响后续的计算，进而造成更大的误差，为此，就产生了滤波技术，通过对收集的数据进行加工处理，使其变得更加平滑、稳定，为此可以总结为以下的用途。
- 减少收集的数据中存在的抖动，使得信号更加稳定。
- 在轨迹计算，姿态预测等等方面，可以用来消除突变点，从而使得曲线更加平滑。
- 在一些定位系统里面，滤波可以减少信号的干扰，从而提高定位的准确性。
- 通过消除噪声，使得陀螺仪、加速度计等等仪器的准确度更符合常理。
### 基础滤波器的局限性
上面的一些简单滤波器例如中值滤波、均值滤波、高斯滤波等等虽然简单易用，但是在比较复杂的环境里面，譬如有大量的动态业务就会差生大量的误差，同时**上面的滤波都只能基于已经存在的数据进行处理————无法预测未来的情况**，上面的滤波算法都是静态的，即他们只能通过数据历史的形态来进行平滑。而他们的平滑也是"一刀切"的做法，没有办法去评估信号到底是不是真的噪声，采取一视同仁的平滑算法。因此就产生接下来要学习的滤波器————卡尔曼滤波器。
### 卡尔曼滤波器的优势区间
- 预测未来：这是卡尔曼内置了一个状态空间模型，可以描述这个空间里面的系统状态，譬如一辆车，可以描述它的位置与速度如何随时间演化。因此，它可以根据上一时刻的状态来预测它未来会是什么样子。
- 可以结合当前的数据进行状态修正，实时更新预测模型，提高精确性。
- 能够正确区分出噪声和信号。

## 卡尔曼滤波的核心
卡尔曼的核心离不开两大概念，"预测"以及"修正"。基于之前的数据来估算当前的值，之后使用传感器进行测量，对当前的预测值进行调整使其更加精确，同时重复两个步骤，使得误差越来越小。

## 卡尔曼滤波的状态变量与预测公式
在卡尔曼滤波器里面，使用状态变量$x_{k}$来描述系统的状态，从下面开始，以预测汽车的位置来作为一个实例。
假如有一辆车，它具有固定的速度和一个确定的位置，需要预测其一秒之后的位置，在这里描述汽车状态的系统就可以使用这个状态变量来完成，其中包含了位置和速度。
$x_{k} = \begin{bmatrix} 车辆位置\\车辆速度\end{bmatrix}$
假如现在这个车以10m/s的速度运行，在10m的位置，从数学上讲，1s之后应该说在20m的位置，这个就是基于当前状态产生的**预测值**,下面那个公式就是卡尔曼的预测阶段。
**$x_{k} = Ax_{k-1}  + Bu_{k} $**
接下来依次解释上面的各个标识符。
- $x_{k}$:表示预测的状态变量，在这里跟上面一样。
- A:表示了状态转移矩阵，这里可以简单理解为用来描述从上一状态k-1变化到k的一个过程。
- B:表示控制输入对状态变化的影响程度，这是一个控制矩阵。
- $u_{k}$:表示控制输入，表示外部施加的影响，譬如风阻、摩擦力那些，如果没有外部输入就可以忽略不计。
## 卡尔曼滤波的状态修正
上面的这条公式可以被称为是卡尔曼滤波器的**预测阶段**，但是现实里面这些风阻摩擦力还有其他各种各样的因素都会实时变化，实时影响，而且传感器收集到的数据未必就是100%精确，也会有噪声，因此，卡尔曼滤波还引入了一个**修正环节**
还是以上面的汽车前进为例子，譬如预测到1s后的距离是20m，但是又会有新的问题，譬如传感器捕获到的距离说19.5m，可能出现了误差。你不一定会完全相信**预测值**，但也不一定会完全相信**观测值**，~~都说中国人是折中的~~,所以就会有折中的方案:**通过取一个权重，来分配预测值和观测值所占比例**，于是便有了下面这一条公式:
**$x_{k} = K_{k} \ast z_{k} + (1-K_{k}) *x_{k}^{-}  $**
 这一条就是卡尔曼滤波里面的修正公式，同时也祝个解释各个表示符的作用。
- $x_{k}^{-}$:就是预测值,对应到例子就是算出来的20m。
- $ z_{k}$:就是实际测量的值，上面的例子就是19.5m。
- $K_{k}$:卡尔曼增益，这是这个修正公式的核心部分，决定了更相信预测值还是更相信观测值。**如果观测值特别可靠，那么可以取较大的卡尔曼增益，反之如果产生了较大的噪声，观测值不太那么靠谱，就要减少对应的卡尔曼增益。**
为了方便计算，可以进行化简，变成
**$x_{k} =x_{k}^{-}  +  K_{K} * (z_{k} -x_{k}^{-})$**
## 卡尔曼滤波的观测矩阵
在上面的例子中，观测值和预测值都是位置，但假如距离传感器坏掉了，只剩下了速度传感器，预测值20m不变，但是观测值变成了9.1m/s，两个值的类型不再相同，这时候就要引入新的**观测矩阵H**
**$x_{k} =x_{k}^{-}  +  K_{K} * (z_{k} -Hx_{k}^{-})$**
状态变量可能会有速度，距离，加速度那些，但是不一定会有全部的传感器对应，可能只有速度传感器，这时候不能直接套公式，需要引入观测矩阵。
**$\begin{bmatrix} 位置\\速度\end{bmatrix} =\begin{bmatrix} 20m\\9.1m/s\end{bmatrix}$**
这时候上面的位置是预测值，下面的速度是实际观测值，所以观测矩阵就是H=[0 1],这时候计算完结果$Hx_{k}^{-}$就是9.1，就不会影响到其他的值。
## 卡尔曼滤波的控制矩阵B与$u_{k}$
$Bu_{k}$用于描述外部的输入$u_{k}$如何影响系统的状态,因此在不同的状态系统里面会有不同的B与之一一对应，以上面开车车为例，上面的状态变量是
$x_{k} = \begin{bmatrix} 车辆位置\\车辆速度\end{bmatrix}$
如果没有其他乱七八糟的因素，那么$x_{k}$就是B=0的时候求得的x=x0+v0t,这个时候
$A=\begin{bmatrix} 1 &t \\0  &1\end{bmatrix}$,求出来新的矩阵
$x_{k}=\begin{bmatrix} 新的位置\\新的速度\end{bmatrix}$。
但是当增加了加速度，譬如这个车做匀加速直线运动，那么引入了加速度这个新的外部输入，除了A的部分(车车按照原来的属性移动)，还加入了B的部分(加速度改变了车车的速度)，假如现在有一个新的加速度a，那么$u_{k}=a$,B是一个描述加速度的矩阵。众所周知,$vt=v0+at,x=v0t+v0+0.5at^2$，最后得到了下面的式子
$x_{k}=\begin{bmatrix} 1 &t \\0  &1\end{bmatrix}\begin{bmatrix} 旧的位置\\旧的速度\end{bmatrix}+\begin{bmatrix} \frac{1}{2}t^2 \\t\end{bmatrix}a$。
如果有外部的控制因素，就需要B与$u_{k}$部分的介入，使得状态预测更加精确。
## 卡尔曼滤波增益$K_{k}$
在卡尔曼滤波器里面，比较重要的是卡尔曼滤波的增益，它用来分配观测值与预测值的比重用来减少误差。根据前辈的资料，规定用以下的公式来描述滤波增益。
**$K_{k}=P_{k}^{-} H^{T}(HP_{k}^{-} H^{T}+R)^{-1} $**
接下来解释各个参数的含义
- $K_{k}$:卡尔曼增益，反映了预测结果的**权重值**，增益越大，表明越相信观测值；反之增益越小，则越相信预测值。
- $P_{k}$:预测状态误差的**协方差矩阵**，通俗的去理解来说就是这个矩阵越大，代表预测值越不确定；反之，矩阵越小，则越相信预测值。
- H:**测量矩阵**，用来把预测状态的值(譬如车车的速度位置)，转换成测量空间里面的值，用来连接测量的数据和预测状态的关系。
- R:**噪声协方差矩阵**，用来表示观测值产生的误差，如果观测值越不准确，噪声越大，则矩阵越大；反之，矩阵越小，观测值越不准确，噪声更大。
- T:代表转置矩阵，把矩阵的行和列交换位置。
- -1:逆矩阵，就是矩阵的倒数。

#### 卡尔曼滤波增益里面的$HP_{k}^{-} H^{T}$
比如预测小车一秒之后会到达的位置。需要知道这个预测会有多大的误差，于是误差就被表示为$P_{k}^{-}$，用来表示预测的误差，但是有个问题：预测的误差一般是表示系统的状态，但是测量到的值不一定是上面状态的本身，可能是一个间接量，这时候就需要一个法则，把误差从状态空间映射到测量空间，这时候就引入了测量矩阵H，从而变成了，如果状态观测不准，会不准到什么程度。

#### 卡尔曼滤波增益里面的R
绝大部分时候，观测的数据里面本身也有误差，叫做R,例如仪器自身的误差，观测的数据里面也有噪声，一般而言，仪器厂家会在出厂之后标注这个仪器大概的误差，不需要自己计算出来。

#### 卡尔曼滤波增益里面的$P_{k}^{-}$  
又通过前人的资料来道出下面的公式
**$P_{k}^{-}=F_{k} P_{k-1}F_{K}^{T}  +Q_{k} $**
$F_{k}$:就是状态转移矩阵，从简单浅白的角度理解就是描述物体上怎么从上一步演变到这一步的关系的一个矩阵。
$P_{k-1}$:上一个状态的协方差矩阵。
$Q_{k}$:过程噪声协方差矩阵:矩阵越大，代表这个系统的预测越不准确，滤波器会更相信测量值，反之，会更相信预测值。